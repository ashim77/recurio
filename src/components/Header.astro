---
const { forceSolidBackground = false } = Astro.props;
const navItems = [
	{ label: 'Home', href: '/' },
	{ label: 'Features', href: '/features' },
	{ label: 'Pricing', href: '/pricing' },
	{ label: 'Docs', href: 'https://help.wprecurio.com/docs/', external: true },
	{ label: 'Support', href: 'https://help.wprecurio.com/docs/', external: true },
];
---

<header
	data-site-header
	data-force-solid={forceSolidBackground ? 'true' : 'false'}
	class="fixed left-0 right-0 z-50 transition-all duration-300 top-[52px] sm:top-[56px] bg-white/5 backdrop-blur-xl border-b border-white/10"
>
	<nav class="max-w-7xl mx-auto px-6 lg:px-8">
		<div class="flex items-center justify-between h-20">
			<a href="/" class="flex items-center group">
				<img
					src="/images/recurio-logo.png"
					alt="Recurio - WordPress Subscription Management Plugin"
					class="h-10 w-auto hover:scale-105 transition-transform duration-200"
					loading="eager"
				/>
			</a>

			<div class="hidden md:flex items-center gap-8">
				{navItems.map((item) =>
					item.external ? (
						<a
							href={item.href}
							target="_blank"
							rel="noopener noreferrer"
							class="text-white/80 hover:text-white transition-colors duration-200 font-medium text-sm"
						>
							{item.label}
						</a>
					) : (
						<a
							href={item.href}
							class="text-white/80 hover:text-white transition-colors duration-200 font-medium text-sm"
						>
							{item.label}
						</a>
					),
				)}
			</div>

			<div class="hidden md:flex items-center gap-4">
				<button class="px-5 py-2.5 text-white/90 hover:text-white font-medium text-sm transition-colors duration-200">
					Sign In
				</button>
				<a
					href="/pricing"
					class="px-6 py-2.5 bg-[#90D144] hover:bg-[#7BC135] text-[#093865] font-semibold rounded-full transition-all duration-300 text-sm shadow-lg shadow-[#90D144]/20 hover:shadow-[#90D144]/40"
				>
					Get Started
				</a>
			</div>

			<button data-menu-toggle class="md:hidden text-white p-2" aria-label="Toggle menu">
				<svg
					data-menu-icon="open"
					viewBox="0 0 24 24"
					class="w-6 h-6"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
				>
					<line x1="4" x2="20" y1="12" y2="12"></line>
					<line x1="4" x2="20" y1="6" y2="6"></line>
					<line x1="4" x2="20" y1="18" y2="18"></line>
				</svg>
				<svg
					data-menu-icon="close"
					viewBox="0 0 24 24"
					class="w-6 h-6 hidden"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
				>
					<path d="M18 6 6 18" />
					<path d="m6 6 12 12" />
				</svg>
			</button>
		</div>

		<div data-mobile-menu class="md:hidden py-6 border-t border-white/10 hidden">
			<div class="flex flex-col gap-4">
				{navItems.map((item) =>
					item.external ? (
						<a
							href={item.href}
							target="_blank"
							rel="noopener noreferrer"
							class="text-white/80 hover:text-white transition-colors duration-200 font-medium text-base py-2"
						>
							{item.label}
						</a>
					) : (
						<a
							href={item.href}
							class="text-white/80 hover:text-white transition-colors duration-200 font-medium text-base py-2"
						>
							{item.label}
						</a>
					),
				)}
				<div class="flex flex-col gap-3 pt-4 border-t border-white/10">
					<button class="px-5 py-3 text-white/90 hover:text-white font-medium text-base text-left">
						Sign In
					</button>
					<a
						href="/pricing"
						class="px-6 py-3 bg-[#90D144] hover:bg-[#7BC135] text-[#093865] font-semibold rounded-full transition-all duration-300 text-base shadow-lg text-center"
					>
						Get Started
					</a>
				</div>
			</div>
		</div>
	</nav>
</header>

<script type="module">
	const header = document.querySelector("[data-site-header]");
	const forceSolid = header?.dataset.forceSolid === "true";
	const solidClasses = [
		"bg-gradient-to-r",
		"from-[#093865]",
		"via-[#0B4A7D]",
		"to-[#13B8A6]",
		"shadow-lg",
		"shadow-black/20",
	];
	const glassClasses = ["bg-white/5", "backdrop-blur-xl", "border-b", "border-white/10"];

	const applyHeaderStyle = (solid) => {
		if (!header) return;
		const add = solid ? solidClasses : glassClasses;
		const remove = solid ? glassClasses : solidClasses;
		header.classList.add(...add);
		header.classList.remove(...remove);
	};

	if (forceSolid) {
		applyHeaderStyle(true);
	} else {
		const onScroll = () => applyHeaderStyle(window.scrollY > 20);
		onScroll();
		window.addEventListener("scroll", onScroll);
	}

	const toggleButton = document.querySelector("[data-menu-toggle]");
	const mobileMenu = document.querySelector("[data-mobile-menu]");
	const openIcon = document.querySelector('[data-menu-icon="open"]');
	const closeIcon = document.querySelector('[data-menu-icon="close"]');

	const setMenuOpen = (open) => {
		if (!mobileMenu || !openIcon || !closeIcon) return;
		mobileMenu.classList.toggle("hidden", !open);
		openIcon.classList.toggle("hidden", open);
		closeIcon.classList.toggle("hidden", !open);
	};

	toggleButton?.addEventListener("click", () => {
		const isOpen = !mobileMenu?.classList.contains("hidden");
		setMenuOpen(!isOpen);
	});

	mobileMenu?.querySelectorAll("a").forEach((link) => {
		link.addEventListener("click", () => setMenuOpen(false));
	});
</script>
